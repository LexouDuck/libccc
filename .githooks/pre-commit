#!/bin/sh

  IO_RESET="\033[0m"
    IO_RED="\033[0;31m"
  IO_GREEN="\033[0;32m"
 IO_YELLOW="\033[0;33m"
   IO_BLUE="\033[0;34m"
IO_MAGENTA="\033[0;35m"
   IO_CYAN="\033[0;36m"


# filepath of the version file
VERSIONFILE=VERSION

# get list of files with changes in this commit
FILES=`git diff  --cached  --name-only` # | awk '{ print "\"" $0 "\"" } ' | tr '\n' ' '`
printf "Files changed:$IO_CYAN\n$FILES\n$IO_RESET"

SRCS=`make show-lists && make help-makefiles | cut -d' ' -f 1`

for i in "$SRCS" ; do
	if echo "$FILES" | grep -q "$i" ; then
		match=1
		FILES="$FILES $i"
	fi
done

if [ "$match" ]; then
	printf "Detected changes to source files.\n"
	if echo "$FILES" | grep -q "$VERSIONFILE" ; then
		printf "version file '$VERSIONFILE' has already been updated.\n"
	else
		make version-patch || exit 1
		git add $VERSIONFILE
	fi
fi

exit 0
